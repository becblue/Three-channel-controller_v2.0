# 继电器控制模块测试指导

## 测试目标
验证第三阶段第一步开发的继电器控制模块的所有功能，确保系统稳定可靠运行。

## 测试环境要求
- **硬件**: STM32F103RCT6开发板
- **调试工具**: USART1串口调试（115200波特率）
- **电源**: 确保系统正常供电
- **连接**: 确保调试串口正常连接

## 测试程序说明

### 自动测试时间表
系统启动后会按以下时间自动执行测试：

| 时间 | 测试项目 | 说明 |
|------|----------|------|
| 启动后10秒 | 基础继电器测试 | 使用Relay_Control_TestAll()进行基础功能测试 |
| 启动后30秒 | 完整功能测试 | 使用Relay_Control_FullTest()进行全面测试 |
| 启动后60秒 | 中断模拟测试 | 使用Relay_Control_InterruptTest()模拟中断处理 |

### 测试内容详解

#### 1. 基础继电器测试 (10秒后执行)
- **功能**: 测试每个通道的基本开启/关闭功能
- **覆盖**: 继电器脉冲控制、状态验证
- **预期结果**: 
  - 每个通道能正常开启和关闭
  - 状态反馈正确
  - 无异常标志产生

#### 2. 完整功能测试 (30秒后执行)
包含10个详细测试项目：

**测试1: 系统状态检查**
- 输出当前系统状态和异常状态
- 验证系统就绪标志

**测试2: 初始状态验证**
- 检查三路使能信号是否为高电平
- 检查所有继电器状态是否为低电平
- 验证系统初始状态正确性

**测试3: 单通道详细测试**
- 对每个通道进行详细的开启/关闭测试
- 显示测试前、测试中、测试后的状态
- 验证状态转换的正确性

**测试4: 异常处理测试**
- 测试异常标志的设置和清除
- 验证异常管理系统的正确性

**测试5: 稳定性检查测试**
- 测试50ms间隔3次检测机制
- 验证信号稳定性检查功能

**测试6: 通道互锁检查测试**
- 验证通道互锁保护机制
- 确保多通道冲突检测正常

**测试7: 状态反馈检查测试**
- 测试其他通道状态反馈检查
- 验证异常检测机制

**测试8: 任务管理测试**
- 测试任务创建、状态检查、处理流程
- 验证状态机驱动的任务管理

**测试9: 系统自检测试**
- 执行完整的系统自检
- 验证自检功能的正确性

**测试10: 最终状态检查**
- 输出测试完成后的系统状态
- 确认系统处于正常状态

#### 3. 中断模拟测试 (60秒后执行)
- **模拟K1_EN下降沿中断**: 测试通道1开启的完整流程
- **模拟K1_EN上升沿中断**: 测试通道1关闭的完整流程
- **验证中断处理逻辑**: 确保中断触发的业务逻辑正确

## 测试操作步骤

### 第一步：准备工作
1. 确保硬件连接正确
2. 打开串口调试工具（115200波特率）
3. 编译并下载程序到开发板
4. 复位系统开始测试

### 第二步：观察测试过程
1. **系统启动阶段** (0-10秒)
   - 观察系统初始化信息
   - 确认继电器控制模块初始化成功
   - 查看自检结果

2. **基础测试阶段** (10-30秒)
   - 观察基础继电器测试输出
   - 确认每个通道测试结果
   - 记录任何异常信息

3. **完整测试阶段** (30-60秒)
   - 观察10个测试项目的详细输出
   - 确认每个测试项目的通过状态
   - 记录测试结果

4. **中断测试阶段** (60-90秒)
   - 观察中断模拟测试过程
   - 确认中断处理逻辑正确
   - 查看最终测试总结

### 第三步：结果分析
1. **成功标识**: 查看?标记表示测试通过
2. **警告标识**: 查看??标记表示需要注意的情况
3. **错误标识**: 查看?标记表示测试失败
4. **测试总结**: 查看最终的测试总结报告

## 预期测试结果

### 正常情况下的预期输出

#### 系统启动信息
```
继电器控制模块初始化开始
继电器初始化开始
...
继电器控制模块初始化完成
继电器控制系统自检开始
? 继电器控制系统自检通过
```

#### 基础测试预期结果
```
=== 基础继电器测试完成 ===
通道1开启测试通过
通道1关闭测试通过
...（所有通道测试通过）
```

#### 完整测试预期结果
```
? 初始状态检查通过
? 通道X开启测试通过
? 通道X关闭测试通过
? 异常标志A设置成功
? 异常标志A清除成功
...（所有测试项目通过）
```

#### 中断测试预期结果
```
? 通道1开启中断处理成功
? 通道1关闭中断处理成功
```

#### 最终测试总结
```
?          继电器控制模块测试总结          ?
? 基础继电器测试: 完成
? 完整功能测试: 完成  
? 中断模拟测试: 完成
? 第三阶段第一步开发验证: 成功完成!
```

### 可能出现的异常情况

#### 1. 硬件相关异常
- **SW状态不一致**: 这是正常现象，因为SW状态硬件未连接
- **继电器状态异常**: 可能是硬件连接问题

#### 2. 系统异常
- **看门狗复位**: 检查喂狗操作是否正常
- **初始状态异常**: 检查GPIO配置是否正确

#### 3. 测试失败处理
- **单项测试失败**: 查看具体错误信息，分析原因
- **多项测试失败**: 可能是系统性问题，需要检查基础配置

## 测试验证要点

### 1. 功能验证
- [ ] 继电器能正常开启和关闭
- [ ] 状态反馈正确
- [ ] 异常处理正常
- [ ] 中断响应正确

### 2. 安全验证
- [ ] 通道互锁机制有效
- [ ] 50ms间隔3次检测正常
- [ ] 看门狗保护机制正常
- [ ] 异常标志系统正常

### 3. 性能验证
- [ ] 响应时间符合要求
- [ ] 系统稳定性良好
- [ ] 内存使用正常
- [ ] 任务调度正常

## 故障排除

### 常见问题及解决方案

1. **系统无输出**
   - 检查串口连接和波特率设置
   - 确认程序正确下载到开发板

2. **测试失败**
   - 查看具体错误信息
   - 检查硬件连接
   - 确认GPIO配置正确

3. **异常标志频繁触发**
   - 检查硬件状态
   - 确认SW状态未连接是否正常
   - 查看系统时序是否正确

4. **看门狗复位**
   - 检查延时操作中的喂狗机制
   - 确认系统负载不会导致超时

## 测试完成确认

完成所有测试后，确认以下要点：

- [ ] 所有自动测试都已执行完成
- [ ] 测试结果符合预期
- [ ] 无严重错误或异常
- [ ] 系统状态正常
- [ ] 继电器控制功能正常

## 下一步行动

测试完成且结果正常后，可以：
1. 记录测试结果和发现的问题
2. 更新开发报告
3. 准备进入第三阶段第二步开发
4. 如有问题，进行相应的修复和重新测试

---

**注意**: 本测试程序设计为自动化执行，无需人工干预。只需观察串口输出并记录结果即可。 